%% start of file `moderncvstylegoettingen.sty'.
%% Copyright 2008 Saikat Banerjee (bnrj.saikat@gmail.com).
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License version 1.3c,
% available at http://www.latex-project.org/lppl/.


%-------------------------------------------------------------------------------
%                identification
%-------------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{moderncvstylegoettingen}[2018/10/10 v0.0.1 modern curriculum vitae scheme: goettingen]

% head section alignment options: ``left'' (default) or ``right''
\@initializecommand{\moderncvstyleheadoptions}{}
\DeclareOption{left} {\edef\moderncvstyleheadoptions{\moderncvstyleheadoptions,left}}
\DeclareOption{right}{\edef\moderncvstyleheadoptions{\moderncvstyleheadoptions,right}}

\DeclareOption*{}% avoid choking on unknown options
\ExecuteOptions{right}
\ProcessOptions*\relax% \ProcessOptions* processes the options in the order provided (i.e., with the later ones possibly overriding the former ones), while \ProcessOptions processes them in the order of the package

%-------------------------------------------------------------------------------
%                required packages
%-------------------------------------------------------------------------------
\usepackage{tikz}

%-------------------------------------------------------------------------------
%                fonts & icons
%-------------------------------------------------------------------------------
\usepackage{amsmath}
\usepackage[T1]{fontenc}
\usepackage{charter}           %% For normal text
\usepackage{ClearSans}
\usepackage{newtxmath}         %% For math fonts

\moderncvicons{awesome}
\newcommand{\externallinksymbol}{{\small\faExternalLink}~}

%-------------------------------------------------------------------------------
%                package options
%-------------------------------------------------------------------------------
\microtypesetup{tracking=true, kerning=true, spacing=true, factor=1100, stretch=10, shrink=10}


%-------------------------------------------------------------------------------
%                header, body & footer
%-------------------------------------------------------------------------------
\moderncvhead[\moderncvstyleheadoptions]{2}
\moderncvbody{1}
\moderncvfoot{1}

%% Redefine section and subsection (only for the spacing)
\RenewDocumentCommand{\section}{sm}{%
  \par\addvspace{3.5ex}%
  \phantomsection{}% reset the anchor for hyperrefs
  \addcontentsline{toc}{section}{#2}%
  \cvitem[0ex]{\strut\raggedleft\raisebox{\baseletterheight}{\color{color1}\rule{\hintscolumnwidth}{0.95ex}}}{\strut\sectionstyle{#2}}%
  %\par\nobreak\addvspace{1.5ex}\@afterheading}% to avoid a pagebreak after the heading
  \par\nobreak\addvspace{1.5ex}\@afterheading}% to avoid a pagebreak after the heading

\RenewDocumentCommand{\subsection}{sm}{%
  \par\addvspace{2ex}%
  \phantomsection{}% reset the anchor for hyperrefs
  \addcontentsline{toc}{subsection}{#2}%
  \cvitem[0ex]{}{\strut\subsectionstyle{#2}}%
  \par\nobreak\addvspace{.5ex}\@afterheading}% to avoid a pagebreak after the heading

%% Redefine the sequence of elements in the footer
\renewcommand*{\makecvfoot}{%
  \recomputecvfootlengths{}%
  \fancypagestyle{plain}{%
    \fancyfoot[c]{%
      \parbox[b]{\footwidth}{%
        \centering%
        \color{color2}\addressfont%
        \vspace{\baselineskip}% forces a white line to ensure space between main text and footer (as footer height can't be known in advance)
        %\addtofoot{\homepagesymbol\emailsymbol\fixedphonesymbol\mobilephonesymbol\linkedinsocialsymbol\twittersocialsymbol\githubsocialsymbol}\flushfoot\@firstfootelementtrue\\[0.25em]%
        \ifthenelse{\isundefined{\@homepage}}{}{\addtofoot{\homepagesymbol\httplink{\@homepage}}}%
        \ifthenelse{\isundefined{\@email}}{}{\addtofoot{\emailsymbol\emaillink{\@email}}\flushfoot\@firstfootelementtrue\\[0.25em]}%
        \collectionloop{phones}{% the key holds the phone type (=symbol command prefix), the item holds the number
          \addtofoot{\csname\collectionloopkey phonesymbol\endcsname\collectionloopitem}}\flushfoot\@firstfootelementtrue\\[0.25em]%
        \collectionloop{socials}{% the key holds the social type (=symbol command prefix), the item holds the link
          \addtofoot{\csname\collectionloopkey socialsymbol\endcsname\collectionloopitem}}\flushfoot\@firstfootelementtrue\\[0.25em]%
        \ifthenelse{\isundefined{\@addressstreet}}{}{\addtofoot[]{\addresssymbol\@addressstreet}%
          \ifthenelse{\equal{\@addresscity}{}}{}{\addtofoot[,~]{\@addresscity}}% if \addresstreet is defined, \addresscity and \addresscountry will always be defined but could be empty
          \ifthenelse{\equal{\@addresscountry}{}}{}{\addtofoot[,~]{\@addresscountry}}%
          \flushfoot\@firstfootelementtrue\\}%
        \ifthenelse{\isundefined{\@extrainfo}}{}{\addtofoot{\@extrainfo}}%
        \ifthenelse{\lengthtest{\footboxwidth=0pt}}{}{\flushfoot}% the lengthtest is required to avoid flushing an empty footer, which could cause a blank line due to the \\ after the address, if no other personal info is used
        }}}%
  \pagestyle{plain}}

%-------------------------------------------------------------------------------
%                style definition
%-------------------------------------------------------------------------------
% see moderncv.cls for command declarations that needs to be implemented, e.g. \maketitle, \section, \subsections, \cvline, etc
\newcommand*{\linkstyle}[1]{{\textcolor{color1}{#1}}}
\newcommand*{\authorstyle}[1]{{\scshape\textcolor{color2}{#1}}}

\renewcommand*{\namefont}{\fontfamily{ClearSans-LF}\selectfont\Huge}
\renewcommand*{\sectionfont}{\fontfamily{ClearSans-LF}\selectfont\Large\upshape}
\renewcommand*{\subsectionfont}{\fontfamily{ClearSans-LF}\selectfont\large\upshape}

\renewcommand*{\cventry}[7][.5em]{%
  \cvitem[#1]{#2}{%
    {\bfseries#3}%
    \ifthenelse{\equal{#4}{}}{}{, {\slshape#4}}%
    \ifthenelse{\equal{#5}{}}{}{, #5}%
    \ifthenelse{\equal{#6}{}}{}{, #6}%
    .\strut%
    \ifx&#7&%
      \else{\newline{}\begin{minipage}[t]{\linewidth}\textcolor{color2}{\small#7}\end{minipage}}\fi}
   }

\renewcommand*{\cvlistitem}[2][.5em]{%
  \cvitem[#1]{}{\listitemsymbol\begin{minipage}[t]{\listitemcolumnwidth}#2\end{minipage}}}

\newcommand*{\cvreferee}[6][1em]{%
  \cvitem[#1]{}{
    \listitemsymbol\begin{minipage}[t]{\listitemcolumnwidth}
    {\bfseries#2}, %
    {\slshape#3}, %
    {#4}, %
    {#5}.%
    \newline{}\color{color1}\emailsymbol\slshape\emaillink{#6}%
    \end{minipage}%
    }%
  }

\newcommand*{\cvmidsep}[4][.5em]{%
  \cvitem[#1]{#2}
             {#3 $\mid$ \textcolor{color2}{\small #4}}
  }

\newcommand*{\pubitem}[6][.5em]{%
  \cvitem[#1]{#2}
             {#3%
              \newline{}\authorstyle{#4}%
              \newline{}\href{#6}{{\linkstyle\externallinksymbol}\textcolor{color2}{\small{#5}}}
             }
  }

\endinput
